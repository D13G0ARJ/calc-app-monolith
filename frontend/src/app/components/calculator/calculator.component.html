<div
  class="min-h-screen bg-slate-50 dark:bg-slate-900 flex flex-col items-center justify-center p-4 relative overflow-hidden transition-colors duration-300 selection:bg-blue-200 dark:selection:bg-blue-900">

  <!-- Aurora Background Effects -->
  <div class="absolute top-0 left-0 w-full h-full overflow-hidden z-0 pointer-events-none">
    <div
      class="absolute top-0 left-1/4 w-96 h-96 bg-purple-300 dark:bg-purple-900/40 rounded-full mix-blend-multiply dark:mix-blend-screen filter blur-3xl opacity-70 animate-blob">
    </div>
    <div
      class="absolute top-0 right-1/4 w-96 h-96 bg-blue-300 dark:bg-blue-900/40 rounded-full mix-blend-multiply dark:mix-blend-screen filter blur-3xl opacity-70 animate-blob animation-delay-2000">
    </div>
    <div
      class="absolute -bottom-32 left-1/3 w-96 h-96 bg-pink-300 dark:bg-indigo-900/40 rounded-full mix-blend-multiply dark:mix-blend-screen filter blur-3xl opacity-70 animate-blob animation-delay-4000">
    </div>
    <!-- Grid Pattern Overlay for texture -->
    <div class="absolute inset-0 bg-grid-slate-200/[0.04] dark:bg-grid-slate-800/[0.04] bg-[bottom_1px_center]"></div>
  </div>

  <!-- App Header -->
  <div class="relative z-10 mb-8 text-center animate-fade-in space-y-2">
    <h1
      class="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-600 dark:from-blue-400 dark:via-purple-400 dark:to-indigo-400 tracking-tighter drop-shadow-sm">
      Calculator
    </h1>
    <p class="text-slate-500 dark:text-slate-400 text-sm font-medium tracking-wide uppercase opacity-80">Simple &
      Elegant</p>
  </div>

  <!-- Calculator Card -->
  <div
    class="relative z-10 bg-white/80 dark:bg-slate-800/80 backdrop-blur-xl rounded-3xl shadow-2xl w-full max-w-sm overflow-hidden border border-slate-200/50 dark:border-slate-700/50 transition-colors duration-300 ring-1 ring-black/5">

    <!-- Theme Toggle Button -->
    <button (click)="themeService.toggleTheme()"
      class="absolute top-4 left-4 z-20 w-10 h-10 rounded-full bg-slate-100/80 dark:bg-slate-700/80 backdrop-blur text-slate-600 dark:text-yellow-400 flex items-center justify-center hover:scale-110 active:scale-95 transition-all shadow-sm border border-slate-200 dark:border-slate-600">
      @if (themeService.darkMode()) {
      <!-- Sun Icon -->
      <svg class="w-5 h-5 animate-spin-slow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
      </svg>
      } @else {
      <!-- Moon Icon -->
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
      </svg>
      }
    </button>

    <!-- Error Overlay -->
    @if (errorMessage === 'Cannot divide by zero') {
    <div
      class="absolute inset-0 z-50 bg-slate-900/90 backdrop-blur-sm flex flex-col items-center justify-center p-6 text-center animate-fade-in">
      <div
        class="w-16 h-16 bg-red-500 rounded-full flex items-center justify-center mb-4 shadow-lg shadow-red-500/50 animate-bounce">
        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
        </svg>
      </div>
      <h3 class="text-white text-xl font-bold mb-2">¡Error Matemático!</h3>
      <p class="text-slate-300 text-sm mb-6">No se puede dividir entre cero.</p>
      <button (click)="reset()"
        class="bg-white text-slate-900 font-bold py-3 px-8 rounded-xl hover:scale-105 active:scale-95 transition-transform">
        Entendido
      </button>
    </div>
    }

    <!-- Display -->
    <div
      class="bg-slate-900/95 dark:bg-black/95 p-8 pt-12 pb-6 text-right transition-colors duration-300 backdrop-blur-md">
      <div class="text-slate-400 text-sm h-6 font-medium tracking-wider mb-1">
        @if (firstOperand !== null && operator) {
        {{ firstOperand }} {{ operator }}
        }
      </div>
      <div
        class="text-6xl text-white font-light break-all flex items-center justify-end tracking-tight leading-none min-h-[4rem]">
        {{ displayValue | number:'1.0-6' }}
      </div>
    </div>

    <!-- Keypad -->
    <div class="p-4 bg-slate-50/50 dark:bg-slate-800/50 transition-colors duration-300">
      <div class="grid grid-cols-4 gap-3">

        <!-- Row 1 -->
        <button (click)="reset()"
          class="col-span-3 h-16 bg-slate-200/80 hover:bg-slate-300 active:bg-slate-400 dark:bg-slate-600/80 dark:hover:bg-slate-500 dark:text-white text-slate-800 font-medium text-xl rounded-2xl transition-colors backdrop-blur-sm">
          C
        </button>
        <button (click)="handleOperator('/')" [class.bg-blue-100]="operator === '/'"
          [class.text-blue-700]="operator === '/'"
          class="h-16 bg-blue-500 hover:bg-blue-600 active:bg-blue-700 text-white font-medium text-2xl rounded-2xl transition-all shadow-sm shadow-blue-500/30">
          &divide;
        </button>

        <!-- Row 2 -->
        <button (click)="inputDigit('7')"
          class="h-16 bg-white hover:bg-slate-50 active:bg-slate-100 dark:bg-slate-700 dark:hover:bg-slate-600 dark:text-white dark:border-slate-600 text-slate-900 font-medium text-2xl rounded-2xl shadow-sm border-b-2 border-slate-200 dark:border-slate-800 transition-all">7</button>
        <button (click)="inputDigit('8')"
          class="h-16 bg-white hover:bg-slate-50 active:bg-slate-100 dark:bg-slate-700 dark:hover:bg-slate-600 dark:text-white dark:border-slate-600 text-slate-900 font-medium text-2xl rounded-2xl shadow-sm border-b-2 border-slate-200 dark:border-slate-800 transition-all">8</button>
        <button (click)="inputDigit('9')"
          class="h-16 bg-white hover:bg-slate-50 active:bg-slate-100 dark:bg-slate-700 dark:hover:bg-slate-600 dark:text-white dark:border-slate-600 text-slate-900 font-medium text-2xl rounded-2xl shadow-sm border-b-2 border-slate-200 dark:border-slate-800 transition-all">9</button>
        <button (click)="handleOperator('*')" [class.bg-blue-100]="operator === '*'"
          [class.text-blue-700]="operator === '*'"
          class="h-16 bg-blue-500 hover:bg-blue-600 active:bg-blue-700 text-white font-medium text-2xl rounded-2xl transition-all shadow-sm shadow-blue-500/30">&times;</button>

        <!-- Row 3 -->
        <button (click)="inputDigit('4')"
          class="h-16 bg-white hover:bg-slate-50 active:bg-slate-100 dark:bg-slate-700 dark:hover:bg-slate-600 dark:text-white dark:border-slate-600 text-slate-900 font-medium text-2xl rounded-2xl shadow-sm border-b-2 border-slate-200 dark:border-slate-800 transition-all">4</button>
        <button (click)="inputDigit('5')"
          class="h-16 bg-white hover:bg-slate-50 active:bg-slate-100 dark:bg-slate-700 dark:hover:bg-slate-600 dark:text-white dark:border-slate-600 text-slate-900 font-medium text-2xl rounded-2xl shadow-sm border-b-2 border-slate-200 dark:border-slate-800 transition-all">5</button>
        <button (click)="inputDigit('6')"
          class="h-16 bg-white hover:bg-slate-50 active:bg-slate-100 dark:bg-slate-700 dark:hover:bg-slate-600 dark:text-white dark:border-slate-600 text-slate-900 font-medium text-2xl rounded-2xl shadow-sm border-b-2 border-slate-200 dark:border-slate-800 transition-all">6</button>
        <button (click)="handleOperator('-')" [class.bg-blue-100]="operator === '-'"
          [class.text-blue-700]="operator === '-'"
          class="h-16 bg-blue-500 hover:bg-blue-600 active:bg-blue-700 text-white font-medium text-2xl rounded-2xl transition-all shadow-sm shadow-blue-500/30">&minus;</button>

        <!-- Row 4 -->
        <button (click)="inputDigit('1')"
          class="h-16 bg-white hover:bg-slate-50 active:bg-slate-100 dark:bg-slate-700 dark:hover:bg-slate-600 dark:text-white dark:border-slate-600 text-slate-900 font-medium text-2xl rounded-2xl shadow-sm border-b-2 border-slate-200 dark:border-slate-800 transition-all">1</button>
        <button (click)="inputDigit('2')"
          class="h-16 bg-white hover:bg-slate-50 active:bg-slate-100 dark:bg-slate-700 dark:hover:bg-slate-600 dark:text-white dark:border-slate-600 text-slate-900 font-medium text-2xl rounded-2xl shadow-sm border-b-2 border-slate-200 dark:border-slate-800 transition-all">2</button>
        <button (click)="inputDigit('3')"
          class="h-16 bg-white hover:bg-slate-50 active:bg-slate-100 dark:bg-slate-700 dark:hover:bg-slate-600 dark:text-white dark:border-slate-600 text-slate-900 font-medium text-2xl rounded-2xl shadow-sm border-b-2 border-slate-200 dark:border-slate-800 transition-all">3</button>
        <button (click)="handleOperator('+')" [class.bg-blue-100]="operator === '+'"
          [class.text-blue-700]="operator === '+'"
          class="h-16 bg-blue-500 hover:bg-blue-600 active:bg-blue-700 text-white font-medium text-2xl rounded-2xl transition-all shadow-sm shadow-blue-500/30">+</button>

        <!-- Row 5 -->
        <button (click)="inputDigit('0')"
          class="col-span-2 h-16 bg-white hover:bg-slate-50 active:bg-slate-100 dark:bg-slate-700 dark:hover:bg-slate-600 dark:text-white dark:border-slate-600 text-slate-900 font-medium text-2xl rounded-2xl shadow-sm border-b-2 border-slate-200 dark:border-slate-800 transition-all">0</button>
        <button (click)="inputDecimal()"
          class="h-16 bg-white hover:bg-slate-50 active:bg-slate-100 dark:bg-slate-700 dark:hover:bg-slate-600 dark:text-white dark:border-slate-600 text-slate-900 font-medium text-2xl rounded-2xl shadow-sm border-b-2 border-slate-200 dark:border-slate-800 transition-all">.</button>
        <button (click)="calculate()"
          class="h-16 bg-orange-500 hover:bg-orange-600 active:bg-orange-700 text-white font-bold text-2xl rounded-2xl transition-all flex items-center justify-center">
          @if (loading) {
          <svg class="animate-spin h-6 w-6 text-white" xmlns="http://www.w3.org/2000/svg" fill="none"
            viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor"
              d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
            </path>
          </svg>
          } @else {
          =
          }
        </button>
      </div>
    </div>

    <!-- History Link -->
    <div class="px-6 pb-6 pt-2 text-center bg-slate-50/50 dark:bg-slate-800/50">
      <a routerLink="/history"
        class="text-xs text-slate-500 hover:text-blue-600 dark:text-slate-400 dark:hover:text-blue-400 font-medium transition-colors flex items-center justify-center gap-1 group">
        <span>Ver Historial de Cálculos</span>
        <svg class="w-3 h-3 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor"
          viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </a>
    </div>

  </div>
</div>