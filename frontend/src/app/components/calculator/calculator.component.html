<div class="min-h-screen bg-slate-100 flex items-center justify-center p-4">
  <div class="bg-white rounded-3xl shadow-2xl w-full max-w-sm overflow-hidden border border-slate-200 relative">

    <!-- Error Overlay -->
    @if (errorMessage === 'Cannot divide by zero') {
    <div
      class="absolute inset-0 z-50 bg-slate-900/90 backdrop-blur-sm flex flex-col items-center justify-center p-6 text-center animate-fade-in">
      <div
        class="w-16 h-16 bg-red-500 rounded-full flex items-center justify-center mb-4 shadow-lg shadow-red-500/50 animate-bounce">
        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
        </svg>
      </div>
      <h3 class="text-white text-xl font-bold mb-2">¡Error Matemático!</h3>
      <p class="text-slate-300 text-sm mb-6">No se puede dividir entre cero. Destruirías el universo.</p>
      <button (click)="reset()"
        class="bg-white text-slate-900 font-bold py-3 px-8 rounded-xl hover:scale-105 active:scale-95 transition-transform">
        Entendido
      </button>
    </div>
    }

    <!-- Display -->
    <div class="bg-slate-900 p-8 pt-12 pb-4 text-right">
      <div class="text-slate-400 text-sm h-6 font-medium tracking-wider mb-2">
        @if (firstOperand !== null && operator) {
        {{ firstOperand }} {{ operator }}
        }
      </div>
      <div
        class="text-6xl text-white font-light break-all flex items-center justify-end tracking-tight leading-none min-h-[4rem]">
        {{ displayValue | number:'1.0-6' }}
      </div>
    </div>

    <!-- Keypad -->
    <div class="p-4 bg-slate-50">
      <div class="grid grid-cols-4 gap-3">

        <!-- Row 1 -->
        <button (click)="reset()"
          class="col-span-3 h-16 bg-slate-200 hover:bg-slate-300 active:bg-slate-400 text-slate-800 font-medium text-xl rounded-2xl transition-colors">
          C
        </button>
        <button (click)="handleOperator('/')" [class.bg-blue-100]="operator === '/'"
          [class.text-blue-700]="operator === '/'"
          class="h-16 bg-blue-500 hover:bg-blue-600 active:bg-blue-700 text-white font-medium text-2xl rounded-2xl transition-all">
          &divide;
        </button>

        <!-- Row 2 -->
        <button (click)="inputDigit('7')"
          class="h-16 bg-white hover:bg-slate-100 active:bg-slate-200 text-slate-900 font-medium text-2xl rounded-2xl shadow-sm border-b-2 border-slate-200 transition-all">7</button>
        <button (click)="inputDigit('8')"
          class="h-16 bg-white hover:bg-slate-100 active:bg-slate-200 text-slate-900 font-medium text-2xl rounded-2xl shadow-sm border-b-2 border-slate-200 transition-all">8</button>
        <button (click)="inputDigit('9')"
          class="h-16 bg-white hover:bg-slate-100 active:bg-slate-200 text-slate-900 font-medium text-2xl rounded-2xl shadow-sm border-b-2 border-slate-200 transition-all">9</button>
        <button (click)="handleOperator('*')" [class.bg-blue-100]="operator === '*'"
          [class.text-blue-700]="operator === '*'"
          class="h-16 bg-blue-500 hover:bg-blue-600 active:bg-blue-700 text-white font-medium text-2xl rounded-2xl transition-all">&times;</button>

        <!-- Row 3 -->
        <button (click)="inputDigit('4')"
          class="h-16 bg-white hover:bg-slate-100 active:bg-slate-200 text-slate-900 font-medium text-2xl rounded-2xl shadow-sm border-b-2 border-slate-200 transition-all">4</button>
        <button (click)="inputDigit('5')"
          class="h-16 bg-white hover:bg-slate-100 active:bg-slate-200 text-slate-900 font-medium text-2xl rounded-2xl shadow-sm border-b-2 border-slate-200 transition-all">5</button>
        <button (click)="inputDigit('6')"
          class="h-16 bg-white hover:bg-slate-100 active:bg-slate-200 text-slate-900 font-medium text-2xl rounded-2xl shadow-sm border-b-2 border-slate-200 transition-all">6</button>
        <button (click)="handleOperator('-')" [class.bg-blue-100]="operator === '-'"
          [class.text-blue-700]="operator === '-'"
          class="h-16 bg-blue-500 hover:bg-blue-600 active:bg-blue-700 text-white font-medium text-2xl rounded-2xl transition-all">&minus;</button>

        <!-- Row 4 -->
        <button (click)="inputDigit('1')"
          class="h-16 bg-white hover:bg-slate-100 active:bg-slate-200 text-slate-900 font-medium text-2xl rounded-2xl shadow-sm border-b-2 border-slate-200 transition-all">1</button>
        <button (click)="inputDigit('2')"
          class="h-16 bg-white hover:bg-slate-100 active:bg-slate-200 text-slate-900 font-medium text-2xl rounded-2xl shadow-sm border-b-2 border-slate-200 transition-all">2</button>
        <button (click)="inputDigit('3')"
          class="h-16 bg-white hover:bg-slate-100 active:bg-slate-200 text-slate-900 font-medium text-2xl rounded-2xl shadow-sm border-b-2 border-slate-200 transition-all">3</button>
        <button (click)="handleOperator('+')" [class.bg-blue-100]="operator === '+'"
          [class.text-blue-700]="operator === '+'"
          class="h-16 bg-blue-500 hover:bg-blue-600 active:bg-blue-700 text-white font-medium text-2xl rounded-2xl transition-all">+</button>

        <!-- Row 5 -->
        <button (click)="inputDigit('0')"
          class="col-span-2 h-16 bg-white hover:bg-slate-100 active:bg-slate-200 text-slate-900 font-medium text-2xl rounded-2xl shadow-sm border-b-2 border-slate-200 transition-all">0</button>
        <button (click)="inputDecimal()"
          class="h-16 bg-white hover:bg-slate-100 active:bg-slate-200 text-slate-900 font-medium text-2xl rounded-2xl shadow-sm border-b-2 border-slate-200 transition-all">.</button>
        <button (click)="calculate()"
          class="h-16 bg-orange-500 hover:bg-orange-600 active:bg-orange-700 text-white font-bold text-2xl rounded-2xl shadow-lg shadow-orange-200 transition-all flex items-center justify-center">
          @if (loading) {
          <svg class="animate-spin h-6 w-6 text-white" xmlns="http://www.w3.org/2000/svg" fill="none"
            viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor"
              d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
            </path>
          </svg>
          } @else {
          =
          }
        </button>
      </div>
    </div>

    <div class="px-6 pb-6 pt-2 text-center">
      <a routerLink="/history"
        class="text-xs text-slate-400 hover:text-slate-600 underline decoration-slate-300 underline-offset-4">View
        History</a>
    </div>

  </div>
</div>